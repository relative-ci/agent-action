{"version":3,"file":"teamcity.js","sources":["../../../../../../../node_modules/env-ci/services/teamcity.js"],"sourcesContent":["// https://confluence.jetbrains.com/display/TCD10/Predefined+Build+Parameters\n\nimport javaProperties from \"java-properties\";\n\nimport { branch } from \"../lib/git.js\";\n\nconst PROPERTIES_MAPPING = {\n  root: \"teamcity.build.workingDir\",\n  branch: \"teamcity.build.branch\",\n};\n\nconst safeReadProperties = (filePath) => {\n  try {\n    return javaProperties.of(filePath);\n  } catch {\n    return undefined;\n  }\n};\n\nconst getProperties = ({ env, cwd }) => {\n  const buildProperties = env.TEAMCITY_BUILD_PROPERTIES_FILE\n    ? safeReadProperties(env.TEAMCITY_BUILD_PROPERTIES_FILE)\n    : undefined;\n  const configFile = buildProperties\n    ? buildProperties.get(\"teamcity.configuration.properties.file\")\n    : undefined;\n  const configProperties = configFile\n    ? safeReadProperties(configFile)\n    : configFile;\n\n  return Object.fromEntries(\n    Object.keys(PROPERTIES_MAPPING).map((key) => [\n      key,\n      (buildProperties\n        ? buildProperties.get(PROPERTIES_MAPPING[key])\n        : undefined) ||\n        (configProperties\n          ? configProperties.get(PROPERTIES_MAPPING[key])\n          : undefined) ||\n        (key === \"branch\" ? branch({ env, cwd }) : undefined),\n    ]),\n  );\n};\n\nexport default {\n  detect({ env }) {\n    return Boolean(env.TEAMCITY_VERSION);\n  },\n  configuration({ env, cwd }) {\n    return {\n      name: \"TeamCity\",\n      service: \"teamcity\",\n      commit: env.BUILD_VCS_NUMBER,\n      build: env.BUILD_NUMBER,\n      slug: env.TEAMCITY_BUILDCONF_NAME,\n      ...getProperties({ env, cwd }),\n    };\n  },\n};\n"],"names":[],"mappings":";;;AAAA;;;AAMA,MAAM,kBAAkB,GAAG;AAC3B,EAAE,IAAI,EAAE,2BAA2B;AACnC,EAAE,MAAM,EAAE,uBAAuB;AACjC,CAAC;;AAED,MAAM,kBAAkB,GAAG,CAAC,QAAQ,KAAK;AACzC,EAAE,IAAI;AACN,IAAI,OAAO,cAAc,CAAC,EAAE,CAAC,QAAQ,CAAC;AACtC,GAAG,CAAC,MAAM;AACV,IAAI,OAAO,SAAS;AACpB;AACA,CAAC;;AAED,MAAM,aAAa,GAAG,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK;AACxC,EAAE,MAAM,eAAe,GAAG,GAAG,CAAC;AAC9B,MAAM,kBAAkB,CAAC,GAAG,CAAC,8BAA8B;AAC3D,MAAM,SAAS;AACf,EAAE,MAAM,UAAU,GAAG;AACrB,MAAM,eAAe,CAAC,GAAG,CAAC,wCAAwC;AAClE,MAAM,SAAS;AACf,EAAE,MAAM,gBAAgB,GAAG;AAC3B,MAAM,kBAAkB,CAAC,UAAU;AACnC,MAAM,UAAU;;AAEhB,EAAE,OAAO,MAAM,CAAC,WAAW;AAC3B,IAAI,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,GAAG,CAAC,CAAC,GAAG,KAAK;AACjD,MAAM,GAAG;AACT,MAAM,CAAC;AACP,UAAU,eAAe,CAAC,GAAG,CAAC,kBAAkB,CAAC,GAAG,CAAC;AACrD,UAAU,SAAS;AACnB,SAAS;AACT,YAAY,gBAAgB,CAAC,GAAG,CAAC,kBAAkB,CAAC,GAAG,CAAC;AACxD,YAAY,SAAS,CAAC;AACtB,SAAS,GAAG,KAAK,QAAQ,GAAG,MAAM,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC,GAAG,SAAS,CAAC;AAC7D,KAAK,CAAC;AACN,GAAG;AACH,CAAC;;AAED,eAAe;AACf,EAAE,MAAM,CAAC,EAAE,GAAG,EAAE,EAAE;AAClB,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,gBAAgB,CAAC;AACxC,GAAG;AACH,EAAE,aAAa,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE;AAC9B,IAAI,OAAO;AACX,MAAM,IAAI,EAAE,UAAU;AACtB,MAAM,OAAO,EAAE,UAAU;AACzB,MAAM,MAAM,EAAE,GAAG,CAAC,gBAAgB;AAClC,MAAM,KAAK,EAAE,GAAG,CAAC,YAAY;AAC7B,MAAM,IAAI,EAAE,GAAG,CAAC,uBAAuB;AACvC,MAAM,GAAG,aAAa,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,CAAC;AACpC,KAAK;AACL,GAAG;AACH,CAAC;;;;","x_google_ignoreList":[0]}