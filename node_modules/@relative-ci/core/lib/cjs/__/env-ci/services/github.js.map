{"version":3,"file":"github.js","sources":["../../../../../../../node_modules/env-ci/services/github.js"],"sourcesContent":["import { readFileSync } from \"node:fs\";\n\n// https://docs.github.com/en/actions/learn-github-actions/environment-variables#default-environment-variables\nimport { parseBranch } from \"../lib/utils.js\";\n\nconst getPrEvent = ({ env }) => {\n  try {\n    const event = env.GITHUB_EVENT_PATH\n      ? JSON.parse(readFileSync(env.GITHUB_EVENT_PATH, \"utf-8\"))\n      : undefined;\n\n    if (event && event.pull_request) {\n      return {\n        branch: event.pull_request.base\n          ? parseBranch(event.pull_request.base.ref)\n          : undefined,\n        pr: event.pull_request.number,\n      };\n    }\n  } catch {\n    // Noop\n  }\n\n  return { pr: undefined, branch: undefined };\n};\n\nconst getPrNumber = (env) => {\n  const event = env.GITHUB_EVENT_PATH\n    ? JSON.parse(readFileSync(env.GITHUB_EVENT_PATH, \"utf-8\"))\n    : undefined;\n\n  return event && event.pull_request ? event.pull_request.number : undefined;\n};\n\nexport default {\n  detect({ env }) {\n    return Boolean(env.GITHUB_ACTIONS);\n  },\n  configuration({ env, cwd }) {\n    const isPr =\n      env.GITHUB_EVENT_NAME === \"pull_request\" ||\n      env.GITHUB_EVENT_NAME === \"pull_request_target\";\n    const branch = parseBranch(\n      env.GITHUB_EVENT_NAME === \"pull_request_target\"\n        ? `refs/pull/${getPrNumber(env)}/merge`\n        : env.GITHUB_REF,\n    );\n\n    return {\n      name: \"GitHub Actions\",\n      service: \"github\",\n      commit: env.GITHUB_SHA,\n      build: env.GITHUB_RUN_ID,\n      isPr,\n      branch,\n      prBranch: isPr ? branch : undefined,\n      slug: env.GITHUB_REPOSITORY,\n      root: env.GITHUB_WORKSPACE,\n      ...(isPr ? getPrEvent({ env, cwd }) : undefined),\n    };\n  },\n};\n"],"names":["readFileSync","parseBranch"],"mappings":";;;;;AAKA,MAAM,UAAU,GAAG,CAAC,EAAE,GAAG,EAAE,KAAK;AAChC,EAAE,IAAI;AACN,IAAI,MAAM,KAAK,GAAG,GAAG,CAAC;AACtB,QAAQ,IAAI,CAAC,KAAK,CAACA,uBAAY,CAAC,GAAG,CAAC,iBAAiB,EAAE,OAAO,CAAC;AAC/D,QAAQ,SAAS;;AAEjB,IAAI,IAAI,KAAK,IAAI,KAAK,CAAC,YAAY,EAAE;AACrC,MAAM,OAAO;AACb,QAAQ,MAAM,EAAE,KAAK,CAAC,YAAY,CAAC;AACnC,YAAYC,iBAAW,CAAC,KAAK,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG;AACnD,YAAY,SAAS;AACrB,QAAQ,EAAE,EAAE,KAAK,CAAC,YAAY,CAAC,MAAM;AACrC,OAAO;AACP;AACA,GAAG,CAAC,MAAM;AACV;AACA;;AAEA,EAAE,OAAO,EAAE,EAAE,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE;AAC7C,CAAC;;AAED,MAAM,WAAW,GAAG,CAAC,GAAG,KAAK;AAC7B,EAAE,MAAM,KAAK,GAAG,GAAG,CAAC;AACpB,MAAM,IAAI,CAAC,KAAK,CAACD,uBAAY,CAAC,GAAG,CAAC,iBAAiB,EAAE,OAAO,CAAC;AAC7D,MAAM,SAAS;;AAEf,EAAE,OAAO,KAAK,IAAI,KAAK,CAAC,YAAY,GAAG,KAAK,CAAC,YAAY,CAAC,MAAM,GAAG,SAAS;AAC5E,CAAC;;AAED,aAAe;AACf,EAAE,MAAM,CAAC,EAAE,GAAG,EAAE,EAAE;AAClB,IAAI,OAAO,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;AACtC,GAAG;AACH,EAAE,aAAa,CAAC,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE;AAC9B,IAAI,MAAM,IAAI;AACd,MAAM,GAAG,CAAC,iBAAiB,KAAK,cAAc;AAC9C,MAAM,GAAG,CAAC,iBAAiB,KAAK,qBAAqB;AACrD,IAAI,MAAM,MAAM,GAAGC,iBAAW;AAC9B,MAAM,GAAG,CAAC,iBAAiB,KAAK;AAChC,UAAU,CAAC,UAAU,EAAE,WAAW,CAAC,GAAG,CAAC,CAAC,MAAM;AAC9C,UAAU,GAAG,CAAC,UAAU;AACxB,KAAK;;AAEL,IAAI,OAAO;AACX,MAAM,IAAI,EAAE,gBAAgB;AAC5B,MAAM,OAAO,EAAE,QAAQ;AACvB,MAAM,MAAM,EAAE,GAAG,CAAC,UAAU;AAC5B,MAAM,KAAK,EAAE,GAAG,CAAC,aAAa;AAC9B,MAAM,IAAI;AACV,MAAM,MAAM;AACZ,MAAM,QAAQ,EAAE,IAAI,GAAG,MAAM,GAAG,SAAS;AACzC,MAAM,IAAI,EAAE,GAAG,CAAC,iBAAiB;AACjC,MAAM,IAAI,EAAE,GAAG,CAAC,gBAAgB;AAChC,MAAM,IAAI,IAAI,GAAG,UAAU,CAAC,EAAE,GAAS,CAAC,CAAC,GAAG,SAAS,CAAC;AACtD,KAAK;AACL,GAAG;AACH,CAAC;;;;","x_google_ignoreList":[0]}